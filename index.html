<!-- index.html -->
<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>A.B Electronic Shop</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="top-bar">
    <img src="logo.jpeg" alt="شعار المتجر">
    <div class="buttons">
      <button id="login-btn">تسجيل دخول</button>
      <button id="add-product-btn" style="display:none;">إضافة منتج</button>
    </div>
  </div>
  <h1>A.B Electronic Shop</h1>
  <div id="add-product-form" style="display:none;">
    <form id="prodForm" enctype="multipart/form-data">
      <input type="text" name="name" id="prod-name" placeholder="اسم المنتج" required>
      <textarea name="desc" id="prod-desc" placeholder="وصف المنتج" required></textarea>
      <input type="text" name="price" id="prod-price" placeholder="السعر" required>
      <input type="text" name="wa" id="whatsapp-number" placeholder="رقم واتساب بدون +" required>
      <input type="file" name="image" id="img-file" accept="image/*" required>
      <button type="submit">حفظ المنتج</button>
    </form>
    <div id="msg"></div>
  </div>
  <div class="container" id="products-container"></div>
  <footer>&copy; 2025 جميع الحقوق محفوظة لـ A.B Electronic Shop</footer>
  <script src="main.js"></script>
</body>
</html>

/* main.js */
(async function() {
  const API_BASE = 'http://YOUR_SERVER_IP:3000'; // عدّل IP وPort
  const loginBtn = document.getElementById('login-btn');
  const addBtn = document.getElementById('add-product-btn');
  const formDiv = document.getElementById('add-product-form');
  const prodForm = document.getElementById('prodForm');
  const msgDiv = document.getElementById('msg');
  const container = document.getElementById('products-container');

  const ADMIN_PASS = atob("SGVsbG9AV29ybGQ5MA==");
  let isAdmin = false;

  // Admin login/logout
  loginBtn.addEventListener('click', () => {
    if (!isAdmin) {
      const p = prompt('كلمة مرور الأدمن:');
      if (p === ADMIN_PASS) {
        isAdmin = true;
        addBtn.style.display = 'inline-block';
        alert('تم تسجيل الدخول كأدمن');
      } else alert('كلمة المرور غير صحيحة');
    } else {
      isAdmin = false;
      addBtn.style.display = 'none';
      formDiv.style.display = 'none';
      alert('تم تسجيل الخروج');
    }
  });

  // Toggle form
  addBtn.addEventListener('click', ()=>{
    formDiv.style.display = formDiv.style.display === 'block' ? 'none':'block';
  });

  // Load products
  async function loadProducts() {
    try {
      const res = await fetch(`${API_BASE}/api/products`);
      const products = await res.json();
      container.innerHTML = '';
      for (const p of products) {
        const card = document.createElement('div'); card.className='card';
        card.innerHTML = `
          <img src="${p.img}" alt="${p.name}">
          <h3>${p.name}</h3>
          <p>${p.desc}</p>
          <strong>السعر: ${p.price}</strong><br>
          <a href="https://wa.me/${p.wa}?text=${encodeURIComponent('السلام عليكم، أرغب في شراء '+p.name)}" target="_blank">شراء عبر واتساب</a>
        `;
        container.appendChild(card);
      }
    } catch(e) { console.error(e); }
  }

  // Submit form
  prodForm.addEventListener('submit', async e=>{
    e.preventDefault();
    const data = new FormData(prodForm);
    msgDiv.textContent = 'جاري الحفظ...';
    const res = await fetch(`${API_BASE}/api/products`, { method:'POST', body: data });
    const result = await res.json();
    if (res.ok) {
      msgDiv.textContent = 'تم إضافة المنتج!';
      prodForm.reset();
      loadProducts();
    } else msgDiv.textContent = result.error || 'فشل الحفظ.';
  });

  loadProducts();
})();
