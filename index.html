<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>A.B Electronic Shop</title>
  <style>
    /* احتفظ بنفس الـ CSS من قبل */
  </style>
</head>
<body>
  <!-- الهيكل HTML كما في السابق -->
  <div class="top-bar">…</div>
  <h1>A.B Electronic Shop</h1>
  <div id="add-product-form">…</div>
  <div class="container" id="products-container"></div>
  <footer>…</footer>

  <script type="module">
    import { initializeApp }         from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy } 
                                      from "https://www.gstatic.com/firebasejs/9.21.0/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } 
                                      from "https://www.gstatic.com/firebasejs/9.21.0/firebase-storage.js";
    // import { getAnalytics }      from "https://www.gstatic.com/firebasejs/9.21.0/firebase-analytics.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAAEiYmVQ-tq34uHI0AFPOOcw_Ow4v_j30",
      authDomain: "abelectronic-e8ee9.firebaseapp.com",
      projectId: "abelectronic-e8ee9",
      storageBucket: "abelectronic-e8ee9.appspot.com",
      messagingSenderId: "740876799433",
      appId: "1:740876799433:web:4c582934bf9f8fe4792c18",
      measurementId: "G-FY5XTH5376"
    };

    const app     = initializeApp(firebaseConfig);
    // const analytics = getAnalytics(app); // اختياري
    const db      = getFirestore(app);
    const storage = getStorage(app);

    // ... جميع الدوال والـ event listeners كما في الأصل ...

    saveBtn.addEventListener('click', async () => {
      const file = imgInput.files[0];
      const name = document.getElementById('prod-name').value.trim();
      const desc = document.getElementById('prod-desc').value.trim();
      const price= document.getElementById('prod-price').value.trim();
      const wa   = document.getElementById('whatsapp-number').value.trim();
      if (!file || !name || !desc || !price || !wa) {
        alert('يرجى تعبئة جميع الحقول.');
        return;
      }
      // رفع الصورة
      const imgRef   = ref(storage, `products/${Date.now()}_${file.name}`);
      const snapshot = await uploadBytes(imgRef, file);
      const imgURL   = await getDownloadURL(snapshot.ref);

      // ← هنا التعديل: حذف المتغير img المكرر
      await addDoc(collection(db, 'products'), {
        img: imgURL,
        name,
        desc,
        price,
        wa,
        createdAt: new Date()
      });

      alert('تم إضافة المنتج بنجاح!');
      form.reset();
      loadProducts();
    });

    // شغّل تحميل المنتجات عند فتح الصفحة
    loadProducts();
  </script>
</body>
</html>
